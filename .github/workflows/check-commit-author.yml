name: Check Commit Author

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  check-author:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check commit authors
        run: |
          echo "Checking PR commits for valid authors..."
          INVALID_COMMITS=$(git log origin/main..HEAD --format='%an <%ae>' | grep -ivE "thepagent|copilot|chenjian-agent" || true)
          
          if [ -n "$INVALID_COMMITS" ]; then
            echo "❌ Found commits with invalid author:"
            echo "$INVALID_COMMITS"
            exit 1
          fi
          
          echo "✅ All commits are by 'thepagent', 'copilot' or 'chenjian-agent'"
